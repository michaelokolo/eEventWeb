@using Microsoft.AspNetCore.Identity
@using Infrastructure.Identity
@inject SignInManager<ApplicationUser> SignInManager
@inject UserManager<ApplicationUser> UserManager

@if (SignInManager.IsSignedIn(User))
{
    var email = UserManager.GetUserName(User);
    var firstName = email?.Split('@')[0];

    <!-- Desktop Dropdown -->
    <div class="dropdown d-none d-lg-block ms-3">
        <a class="d-flex align-items-center gap-2 text-decoration-none dropdown-toggle profile-link"
           href="#" id="profileDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="bi bi-person-circle fs-3"></i>
            <span class="fw-semibold">@firstName</span>
        </a>
        <ul class="dropdown-menu dropdown-menu-end shadow-sm rounded-3 border-0"
            aria-labelledby="profileDropdown">
            <li class="dropdown-header small text-muted">@email</li>
            <li><a class="dropdown-item" asp-page=""><i class="bi bi-person me-2"></i>Your Profile</a></li>
            <li><a class="dropdown-item" asp-page=""><i class="bi bi-gear me-2"></i>Settings</a></li>
            <li><hr class="dropdown-divider" /></li>
            <li>
                <form asp-area="Identity" asp-page="/Account/Logout"
                      asp-route-returnUrl="@Url.Action("Index", "Home", new { area = "" })"
                      method="post">
                    <button type="submit" class="dropdown-item d-flex align-items-center">
                        <i class="bi bi-box-arrow-right me-2"></i> Sign out
                    </button>
                </form>
            </li>
        </ul>
    </div>

    <!-- Mobile User Section -->
    <div class="d-lg-none mt-4 pt-3 border-top">
        <div class="d-flex align-items-center mb-3 gap-2">
            <i class="bi bi-person-circle fs-3"></i>
            <div>
                <div class="fw-semibold">@firstName</div>
                <small class="text-muted">@email</small>
            </div>
        </div>
        <ul class="list-unstyled d-flex flex-column gap-2">
            <li><a class="dropdown-item" asp-page=""><i class="bi bi-person me-2"></i>Your Profile</a></li>
            <li><a class="dropdown-item" asp-page=""><i class="bi bi-gear me-2"></i>Settings</a></li>
            <li>
                <form asp-area="Identity" asp-page="/Account/Logout"
                      asp-route-returnUrl="@Url.Action("Index", "Home", new { area = "" })"
                      method="post">
                    <button type="submit" class="dropdown-item d-flex align-items-center">
                        <i class="bi bi-box-arrow-right me-2"></i> Sign out
                    </button>
                </form>
            </li>
        </ul>
    </div>
}
else
{
    <div class="d-flex gap-2">
        <a class="btn btn-outline-dark btn-sm fw-semibold px-3" asp-area="Identity" asp-page="/Account/Login">Log in</a>
        <a class="btn btn-dark btn-sm fw-semibold px-3" asp-area="Identity" asp-page="/Account/Register">Sign up</a>
    </div>
}
